import { Head, Image, Appear } from 'mdx-deck'
import { Split } from 'mdx-deck/layouts'
import { SplitRight } from 'mdx-deck/layouts'
import { default as SyntaxHighlighter } from 'react-syntax-highlighter';
import { darcula } from 'react-syntax-highlighter/styles/hljs'
export { default as theme } from './theme'
import { CodeSurfer } from "mdx-deck-code-surfer"

<Head>
  <title>Nubank Clojure</title>
</Head>

<!-- # Nubank & Clojure -->
<Image src="./img/nulogo.png" size="40%" />

---

export default Split

# Nubank

- Cart√£o de Cr√©dito (2014)
- Rewards (2016)
- NuConta (2017)
- Cart√£o de D√©bito (2018)
- Empr√©stimos (2019)


- 6 milh√µes de clientes
- Mais de 220 Engenheiros
- Mais de 200 Microservi√ßos Clojure

---

export default Split

# Quem Somos

Leonardo Iacovini

leonardo.iacovini@nubank.com.br

<br />

Rafael Leal

rafael.leal@nubank.com.br

---

# Clojure

- LISP
- Funcional
- JVM
- REPL

<img width="20%" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/Clojure_logo.svg/1200px-Clojure_logo.svg.png" />

---

# LISP

- Parenteses!
- _Code is Data_
- Primeira apari√ß√£o em 1958
- Common Lisp, Scheme, Clojure (entre outros)!

---

<Image src="https://imgs.xkcd.com/comics/lisp_cycles.png" size="90%"/>

---

<div style={{textAlign: 'left', fontSize: 80}}>
  JS
  <SyntaxHighlighter language='javascript' style={darcula}>
    {`function(arg1, arg2)`}
  </SyntaxHighlighter>
  Clojure
  <SyntaxHighlighter language='clojure' style={darcula}>
    {`(function arg1 arg2)`}
  </SyntaxHighlighter>
</div>

---

## Clojure √© um _dialeto LISP_

Dialeto √© uma variante lingu√≠stica constitu√≠da por caracter√≠sticas fonol√≥gicas, sint√°ticas, sem√¢nticas e morfol√≥gicas pr√≥prias.

---

<Image src="https://i.kym-cdn.com/photos/images/newsfeed/000/173/576/Wat8.jpg?1315930535" size="70%" />

---

Clojure segue a mesma estrutura gramatical e sint√°tica de um LISP, por√©m possui suas carater√≠sticas pr√≥prias de execu√ß√£o e padr√µes

---

# Exemplo (Fatorial)

<div style={{textAlign: 'left', fontSize: 70}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/fatorial.clj")}
  </SyntaxHighlighter>
</div>

---

# Programa√ß√£o Funcional

_Paradigma_ de programa√ß√£o que procura tratar problemas computacionais como a avalia√ß√£o de fun√ß√µes matem√°ticas, tem suas origens no c√°lculo Lambda

- Clojure
- Elixir
- Scala
- Haskell
- F#

---

- Fun√ß√µes puras
- Imutabilidade
- Idempot√™ncia (livre de _side-effects_)
- Fun√ß√µes s√£o valores (First Class Functions)
- Transpar√™ncia referencial
- Programa√ß√£o declarativa

---

# Funcional?

<div style={{textAlign: 'left', fontSize: 30}}>
  <SyntaxHighlighter language='c' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/not-a-function.c")}
  </SyntaxHighlighter>
</div>
<Appear>
<span style={{fontSize: 80}}>
  "Uma rela√ß√£o f:A‚ÜíB √© uma fun√ß√£o quando para qualquer x ‚àà A existe um √∫nico (x,y) ‚àà f."
</span>
  </Appear>

---

# Fun√ß√µes Puras

Os dados recebidos n√£o s√£o alterados. Um novo valor √© criado e retornado

S√£o fun√ß√µes livre de efeitos colaterais

Efeitos colaterais s√£o a√ß√µes que alteram o estado do mundo (Eg: enviar um email, fazer uma transa√ß√£o no DB, etc...)

Fun√ß√µes puras s√£o f√°ceis de entender, testar e seguras de executar! (idempotentes)

---

<span style={{fontSize: 80}}>
  "Uma rela√ß√£o f:A‚ÜíB √© uma fun√ß√£o quando para qualquer x ‚àà A existe um √∫nico (x,y) ‚àà f."
</span>

---

# Imutabilidade

- _Vari√°veis_ n√£o tem seu valor alterado

Se `a = 1`, ent√£o `a` sempre ser√° `1`

- Fun√ß√µes n√£o alteram o valor de suas entradas, elas produzem uma s√°ida com as altera√ß√µes feitas.

`f(a) -> b` onde `b != a` (outro _objeto_ - n√£o √© a mesma refer√™ncia)

---

# Vantagens

- Programa√ß√£o concorrente/paralelismos (thread safety)
- Fica mais f√°cil entender o que o c√≥digo est√° fazendo
- Facilidade para testar

---

# Performace

Isso n√£o deveria piorar a performace? (Listas por exemplo) Preciso ficar copiando
as estruturas toda manipula√ß√£o.

---

# N√ÉO

Clojure usa estruturas de dados otimizadas para opera√ß√µes imut√°veis, a maioria das opera√ß√µes √© feita em O(1).

Se utiliza de tecnicas de re-aproveitamento de mem√≥ria (j√° que os dados n√£o mudam - copy-on-write)

---

Imutabilidade elimina grande parte dos problemas que ocasionam dead-locks. E simplifica nosso c√≥digo

<div style={{textAlign: 'left'}}>
<SyntaxHighlighter language='java' style={darcula}>
{`lock.lock();
doSomething();
lock.unlock();`}
</SyntaxHighlighter>

<SyntaxHighlighter language='java' style={darcula}>
{`synchronized (Lock lock) {
    doSomething()
}`}
</SyntaxHighlighter>
</div>

<span style={{fontSize: 100}}>ü§î</span>

---

export default Split

<div style={{textAlign: 'left'}}>
  Mut√°vel
  <SyntaxHighlighter language='c' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/mutable-fat.c")}
  </SyntaxHighlighter>
</div>

<div style={{textAlign: 'left'}}>
  Imut√°vel
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/fatorial.clj")}
  </SyntaxHighlighter>
</div>

---

# Idempot√™ncia

Em matem√°tica e ci√™ncia da computa√ß√£o, a idempot√™ncia √© a propriedade que algumas opera√ß√µes t√™m de poderem ser aplicadas v√°rias vezes sem que o valor do resultado se altere ap√≥s a aplica√ß√£o inicial.

`f(f(x)) = f(x)`

---

# Fun√ß√µes s√£o Valores

Fun√ß√µes s√£o tratadas como demais tipos (inteiros, float, strings, etc...), e podem ser atribuidas a _vari√°veis_, passadas como argumentos
ou retornadas por outras fun√ß√µes.

---

# High Order Functions

S√£o fun√ß√µes que recebem outras fun√ß√µes como argumento

Ou, fun√ß√µes que retornam outras fun√ß√µes

`f(g(x))  === f‚àòg`

`f(g, a) -> b`

`f(a, b) -> g`

onde `f` e `g` s√£o fun√ß√µes

---

<div style={{textAlign: 'left', fontSize: 50}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/map.clj")}
  </SyntaxHighlighter>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/even.clj")}
  </SyntaxHighlighter>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/comp.clj")}
  </SyntaxHighlighter>
</div>

---

# HoF Comuns

<div style={{textAlign: 'left', fontSize: 60}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/common-hofs.clj")}
  </SyntaxHighlighter>
</div>

Opera√ß√µes em sequ√™ncias!

---

# Refer√™ncia Transparencial

O resultado de uma fun√ß√£o depende apenas dos argumentos que ela recebe

Caracter√≠stica de fun√ß√µes puras

---

# Clojure

<img width="50%" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/Clojure_logo.svg/1200px-Clojure_logo.svg.png" />

https://clojure.org/

---

- Roda na JVM, tem interop com outras linguagens que tamb√©m rodam nela (Java, Scala, Groovy, etc...)
- Din√¢mica
- _REPL Driven Development_
- Simples e intuitiva!

---

# Tipos

<div style={{textAlign: 'left', fontSize: 50}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/types.clj")}
  </SyntaxHighlighter>
</div>

---

> "It is better to have 100 functions operate on one data structure than to have 10 functions operate on 10 data structures." - Alan Perlis

---

# Mapas

Mapas `{}` s√£o usados muito em Clojure para carregar valores juntos (o que geralmente seria um objeto), mas ele cont√©m apenas os valores imut√°veis
e n√£o opera√ß√µes que alteram seu estado.

---

# Blocos

<div style={{textAlign: 'left', fontSize: 50}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/blocks.clj")}
  </SyntaxHighlighter>
</div>

---

# Code is Data

O c√≥digo Clojure em s√≠ √© uma sequ√™ncia de s√≠mbolos em uma `list`

---

# Macros

S√£o _fun√ß√µes_ que operam sobre a estrutura do c√≥digo para modifica-lo antes da compila√ß√£o ou execu√ß√£o

Exemplo: Thread Last Macro `->>`
<div style={{textAlign: 'left', fontSize: 50}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/macros.clj")}
  </SyntaxHighlighter>
</div>

---

# DEMO

---

<div style={{textAlign: 'left', fontSize: 20}}>
  <SyntaxHighlighter language='clojure' style={darcula} wrapLines={false}>
    {require("!raw-loader!./snippets/billing.clj")}
  </SyntaxHighlighter>
</div>

---

## Inscri√ß√µes para Engenharia de Software

<img src="./img/qr.png" width="30%"/>
